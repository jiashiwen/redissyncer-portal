# ToDo

- [x] 发现节点宕机后，修改任务各项状态为broken
- [ ] 迁移任务到其他节点，keepalive 参数为true的任务，当节点宕机时迁移到其他节点
- [ ] 编写nodeservice
    - [X] 获取节点状态
    - [ ] 删除节点，前提是节点已离线
    - [X] 节点健康检查
    - [ ] portal节点自举，当所有portal节点全部宕机的情况下，启动节点时etcd显示节点alive，测试节点是否真正存活，若已宕机则修改状态后启动

- [ ] 任务api
    - [x] 任务创建
    - [x] 任务停止
    - [ ] 任务启动
    - [x] 任务删除
    - [ ] 任务查询
        - [X] 查询所有任务，可自定义pagesize，通过querryid批量返回数据
        - [ ] 根据nodeid查询node上所有任务
        - [x] 根据taskid返回任务状态
        - [x] 根据groupid返回任务状态
        - [x] 根据groupid返回任务状态
        - [ ] 从工作节点获取任务的实时状态，需要直接访问server获取内存中的状态
        - [ ] 综合查询，根据任务节点、任务当前状态返回结果
    - [ ] 实现TaskMigrate 任务迁移

- [ ] etcd补充工具类
    - [x] etcd 游标
    - [X] 在分布式环境下使用游标。具体思路是在etcd中注册游标的queryID，当本地查询不到游标的queryID时，请求etcd中的游标所在位置并发送请求
    - [X] 游标GC
        - [X] 查询完毕清理本地cursorMap
        - [X] 定时检查cursorMap中超时的游标，最后查询时间戳超过阀值既执行过期清理
    - [ ] 游标在分布式环境中测试
- [ ] 模拟springboot的启动方式，同时支持命令行，环境变量，yaml文件配置启动参数